<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>AR Viewer</title>

  <!-- A-Frame & AR.js -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <!-- ★カスタムマーカー（あなたの marker.patt）★ -->
    <a-marker type="pattern" url="marker.patt">
      <a-entity id="okMark" geometry="primitive: circle; radius: 0.5" material="color: green" visible="false">
      </a-entity>

      <a-entity id="ngMark" geometry="primitive: circle; radius: 0.5" material="color: red" visible="false">
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // Firebase設定
    const firebaseConfig = {
      apiKey: "AIzaSy***",
      authDomain: "talk-sign.firebaseapp.com",
      databaseURL: "https://kadaikenkyu-f09eb-default-rtdb.firebaseio.com/",
      projectId: "talk-sign",
      storageBucket: "talk-sign.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdefg123456"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const okMark = document.getElementById("okMark");
    const ngMark = document.getElementById("ngMark");

    // 状態を Firebase から取得
    db.ref("talkStatus").on("value", (snapshot) => {
      const val = snapshot.val();
      if (val === "ok") {
        okMark.setAttribute("visible", true);
        ngMark.setAttribute("visible", false);
      } else {
        okMark.setAttribute("visible", false);
        ngMark.setAttribute("visible", true);
      }
    });
  </script>
</body>

</html>